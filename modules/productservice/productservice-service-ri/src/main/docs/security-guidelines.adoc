:docdir: ../appendices
:icons: font
:author: Digital Journey Product Development Team
:imagesdir: ./images
:imagesoutdir: ./images
//embedded images
:data-uri:
// empty line
:blank: pass:[ +]
// Toc
:toc: macro
:toclevels: 3
:sectnums:
:sectnumlevels: 3
// Variables
:revnumber: 1.0
:arrow: icon:angle-double-down[]
:ms_name: Training Product Microservice
:source-highlighter: highlightjs

image::shared/header.png[]

= {ms_name} - Security Guidelines
v{revnumber}, {docdate}

<<<

.Change Log
[%header,cols=3*]
|===
| Version
| Date
| Changes

| 1.0
| January/2019
| Initial Version
|===

toc::[]

<<<

== Introduction

The purpose of this document is to describe the security guidelines taken into account while developing the {ms_name} micro-service.

It will cover the following topics:

* Hardening - What hardening considerations were followed;
* Algorithms - What security oriented algorithms were used and for what purpose;
* Security Risks - Known security risks that should be taken into consideration by micro-service consumers.

== Hardening
'''

=== Authentication information

Username is stored in a database. As for the password, the system stores an hash of the salted password (the full stored information is hash protocol, hash iterations, public salt and hash of the salted password).
The salt used in the password hash has two parts, public and private.
The public part is randomly generated for each hash so multiple hashes for one password are different.
This part is stored with the hash, so it can be recalculated.
The private part is shared between passwords, but is not stored in the database, only on the security module configuration.
The objective of this part is to prevent all the information to calculate the hash to be stored in the same place.

UAM micro-service starts with a built-in admin user. Although its username and password can be changed via UAM's REST
API, this is only possible after the system is up and running. To avoid this, it's possible to configure the admin default
username and password.

Refresh tokens are encrypted using a symmetric cipher with a prepended random initialization vector.

Access tokens are signed and encrypted using the platform's security module capabilities.

=== User information

[[user-preferences-permisssion]]User preferences management REST API can only be accessed by their owner.

== Algorithms
'''

*Password Hashing*: MD2, MD5, SHA-1, SHA-256, SHA-384 and SHA-512. The default option is SHA-256, which can changed by updating
the "algorithm" property in the configuration with the PID "platform.modules.security.hashservice.default.factory-password".

*Refresh token symmetric cipher*: AES with PBKDF2WithHmacSHA1 keys.

*Access token asymmetric cipher*: token is signed using RS256 and encrypted using RSA-OAEP-256.

== Security Risks
'''

* An attacker with access to an user's access token can hijack its session.
* An attacker with access to the cache contents can read every access and refresh token and,
subsequently, hijack user sessions.
* An attacker with access to the server configuration (e.g. through the server's web console) can read secret information, such as the hash service private salt, or the RSA asymmetric keys generation parameters.
* An attacker with access to the UAM database can read/write user information (except passwords), as well as change users preferences, properties, roles and permissions.
* An attacker with access to the UAM database and server configuration (to read the hash service private salt) can read/write user information and create valid system users.
* Currently, a user which has the permission to read some UAM entity, has the permissions to read all UAM entities (with the preferences exception mentioned <<user-preferences-permisssion, previously>>)
* An attacker with access to the system logs can read login information, including user credentials.
* An attacker which can access the user's machine or the internal cluster network data, or break the HTTPS connection security,
can read the user's access token from any request, or the user's credential in clear text from a basic login request.
